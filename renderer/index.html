<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'" />
  <title>WSL Cleaner</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Custom title bar -->
  <header id="titlebar">
    <div class="titlebar-drag">
      <svg class="titlebar-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 6h18M3 12h18M3 18h18"/>
      </svg>
      <span class="titlebar-title">WSL Cleaner</span>
    </div>
    <div class="titlebar-controls">
      <button id="btn-minimize" class="titlebar-btn" aria-label="Minimize">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect y="5" width="12" height="2" fill="currentColor"/></svg>
      </button>
      <button id="btn-maximize" class="titlebar-btn" aria-label="Maximize">
        <svg width="12" height="12" viewBox="0 0 12 12"><rect x="1" y="1" width="10" height="10" stroke="currentColor" stroke-width="1.5" fill="none"/></svg>
      </button>
      <button id="btn-close" class="titlebar-btn btn-close" aria-label="Close">
        <svg width="12" height="12" viewBox="0 0 12 12"><path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5"/></svg>
      </button>
    </div>
  </header>

  <main id="app">
    <!-- Error screen (shown if WSL not found) -->
    <section id="error-screen" class="screen hidden">
      <div class="error-card">
        <svg class="error-icon" viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="#ff4757" stroke-width="1.5">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
        <h2>WSL 2 Not Detected</h2>
        <p id="error-message">WSL 2 is not installed or no distribution was found.</p>
        <a href="https://learn.microsoft.com/en-us/windows/wsl/install" class="link" target="_blank">Learn how to install WSL 2</a>
      </div>
    </section>

    <!-- Loading screen -->
    <section id="loading-screen" class="screen">
      <div class="loader-wrap">
        <div class="spinner"></div>
        <p>Detecting WSL 2...</p>
      </div>
    </section>

    <!-- Main app screen -->
    <section id="main-screen" class="screen hidden">
      <!-- Status bar -->
      <div id="status-bar">
        <span class="status-dot"></span>
        <span id="status-text">WSL 2 Ready</span>
        <span id="distro-name" class="badge"></span>
      </div>

      <!-- Sidebar + content layout -->
      <div id="main-layout">
        <nav id="sidebar">
          <a class="nav-item active" data-page="simple">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="13,2 3,14 12,14 11,22 21,10 12,10"/>
            </svg>
            <span>Simple</span>
          </a>
          <a class="nav-item" data-page="advanced">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/>
              <line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/>
              <line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/>
              <line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/>
              <line x1="17" y1="16" x2="23" y2="16"/>
            </svg>
            <span>Advanced</span>
          </a>
          <div class="nav-spacer"></div>
          <a class="nav-item" data-page="about">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <span>About</span>
          </a>
        </nav>

        <div id="page-container">
          <!-- ════ Simple Page ════ -->
          <div id="page-simple" class="page">
            <div class="simple-center">
              <div class="simple-hero">
                <svg class="simple-icon" width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                </svg>
                <h2 class="simple-title">WSL Disk Size</h2>
                <div id="simple-size" class="simple-size-value">--</div>
                <p class="simple-desc">Clean your WSL instance and compact the virtual disk to reclaim space.</p>
              </div>

              <button id="btn-simple-go" class="btn-primary btn-simple-go">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
                Clean &amp; Compact
              </button>

              <!-- Disclaimer -->
              <div class="simple-disclaimer">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span>This deletes files &amp; old dependency directories. Use <strong>Advanced</strong> mode to see exactly what will be deleted and control each task. Designed for WSL partitions used for development.</span>
              </div>

              <!-- Step progress list -->
              <div id="simple-steps" class="simple-steps hidden">
                <div class="step-item" data-step="cleanup">
                  <div class="step-icon-slot"></div>
                  <span class="step-label">Running cleanup tasks...</span>
                </div>
                <div class="step-item" data-step="stale">
                  <div class="step-icon-slot"></div>
                  <span class="step-label">Removing stale directories...</span>
                </div>
                <div class="step-item" data-step="shutdown">
                  <div class="step-icon-slot"></div>
                  <span class="step-label">Shutting down WSL...</span>
                </div>
                <div class="step-item" data-step="update">
                  <div class="step-icon-slot"></div>
                  <span class="step-label">Updating WSL...</span>
                </div>
                <div class="step-item" data-step="compact">
                  <div class="step-icon-slot"></div>
                  <span class="step-label">Compacting virtual disk...</span>
                </div>
                <div class="step-item" data-step="restart">
                  <div class="step-icon-slot"></div>
                  <span class="step-label">Restarting WSL...</span>
                </div>
              </div>

              <!-- Result card (reused structure) -->
              <div id="simple-result" class="hidden">
                <div class="result-card">
                  <h3>Cleanup Complete</h3>
                  <div class="size-comparison">
                    <div class="size-box">
                      <span class="size-label">Before</span>
                      <span id="simple-size-before" class="size-value">--</span>
                    </div>
                    <svg class="arrow-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2">
                      <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12,5 19,12 12,19"/>
                    </svg>
                    <div class="size-box">
                      <span class="size-label">After</span>
                      <span id="simple-size-after" class="size-value">--</span>
                    </div>
                  </div>
                  <div class="savings">
                    <span>Space Saved: </span>
                    <span id="simple-space-saved" class="accent">--</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ════ Advanced Page ════ -->
          <div id="page-advanced" class="page hidden">
            <!-- Phase 1: Cleanup tasks -->
            <h2 class="section-title">Cleanup Tasks</h2>
            <p class="section-desc">Select which tasks to run inside your WSL instance. All tasks are enabled by default.</p>

            <div id="task-cards"></div>

            <button id="btn-run-cleanup" class="btn-primary">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
              Run Cleanup
            </button>

            <!-- Log output -->
            <div id="log-panel" class="hidden">
              <div class="log-header">
                <span>Output</span>
                <button id="btn-clear-log" class="btn-small">Clear</button>
              </div>
              <pre id="log-output"></pre>
            </div>

            <!-- Phase 2: Stale Directory Scanner -->
            <h2 class="section-title" style="margin-top: 32px;">Stale Directories</h2>
            <p class="section-desc">Find and remove old dependency and build directories (<code>node_modules</code>, <code>vendor</code>, <code>__pycache__</code>, <code>.next</code>, <code>.nuxt</code>, <code>.turbo</code>, <code>.yarn</code>) that haven't been modified recently. These are safe to delete &mdash; they'll be recreated automatically when you next build or install.</p>

            <div class="stale-controls">
              <div class="stale-toggle-row">
                <label class="toggle" onclick="event.stopPropagation()">
                  <input type="checkbox" id="stale-enabled-cb" checked />
                  <span class="toggle-slider"></span>
                </label>
                <span class="stale-toggle-label">Enable stale directory cleanup</span>
              </div>
              <div class="stale-days-row">
                <label for="stale-days-input">Remove directories not modified in the last</label>
                <input type="number" id="stale-days-input" class="stale-days-input" value="30" min="1" max="365" />
                <span>days</span>
              </div>
            </div>

            <button id="btn-scan-stale" class="btn-primary">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              Scan for Stale Directories
            </button>

            <div id="stale-results" class="hidden">
              <div id="stale-scan-summary" class="stale-scan-summary"></div>
              <div class="stale-toolbar">
                <label class="stale-select-all">
                  <input type="checkbox" id="stale-select-all-cb" checked />
                  <span>Select All</span>
                </label>
              </div>
              <div id="stale-dir-list" class="stale-dir-list"></div>
              <button id="btn-delete-stale" class="btn-primary btn-danger">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3,6 5,6 21,6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                Delete Selected
              </button>
              <div id="stale-delete-result" class="hidden">
                <div class="result-card stale-result-card">
                  <h3>Deletion Complete</h3>
                  <p id="stale-delete-summary"></p>
                </div>
              </div>
            </div>

            <!-- Phase 3: Disk Compaction -->
            <h2 class="section-title" style="margin-top: 32px;">Disk Compaction</h2>
            <p class="section-desc">Shut down WSL, update it, and compact the virtual disk to reclaim unused space on your Windows drive.</p>

            <div id="vhdx-info" class="card">
              <div class="card-body">
                <div class="vhdx-details">
                  <div class="vhdx-row">
                    <span class="label">Virtual Disk</span>
                    <span id="vhdx-path" class="value mono">Searching...</span>
                  </div>
                  <div class="vhdx-row">
                    <span class="label">Current Size</span>
                    <span id="vhdx-size" class="value mono">--</span>
                  </div>
                </div>
              </div>
            </div>

            <button id="btn-compact" class="btn-primary btn-compact">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="17,1 21,5 17,9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                <polyline points="7,23 3,19 7,15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
              </svg>
              Compact Disk
            </button>

            <!-- Compaction result -->
            <div id="compact-result" class="hidden">
              <div class="result-card">
                <h3>Compaction Complete</h3>
                <div class="size-comparison">
                  <div class="size-box">
                    <span class="size-label">Before</span>
                    <span id="size-before" class="size-value">--</span>
                  </div>
                  <svg class="arrow-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12,5 19,12 12,19"/>
                  </svg>
                  <div class="size-box">
                    <span class="size-label">After</span>
                    <span id="size-after" class="size-value">--</span>
                  </div>
                </div>
                <div class="savings">
                  <span>Space Saved: </span>
                  <span id="space-saved" class="accent">--</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ════ About Page ════ -->
          <div id="page-about" class="page hidden">
            <div class="about-center">
              <div class="about-logo">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                </svg>
              </div>
              <h2 class="about-title">WSL Cleaner</h2>
              <span id="about-version" class="badge">v1.0.0</span>
              <p class="about-desc">A lightweight utility to clean, optimize, and compact your Windows Subsystem for Linux installation. Reclaim disk space with one click.</p>

              <div class="about-links">
                <button id="btn-check-updates" class="btn-primary">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="1,4 1,10 7,10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                  </svg>
                  Check for Updates
                </button>
                <button id="btn-github" class="btn-outline">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
                  </svg>
                  View on GitHub
                </button>
              </div>

              <div class="about-footer">
                <p>Made for the WSL community</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
